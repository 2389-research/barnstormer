{# ABOUTME: Mission control compositor: command bar + canvas + mission strip. #}
{# ABOUTME: Loaded into #workspace when a spec is selected; default view is the document canvas. #}

<header class="command-bar">
    <div class="command-bar-left">
        <span class="command-bar-diamond">&#9670;</span>
        <h1 class="command-bar-title">{{ title }}</h1>
        <span class="command-bar-oneliner">{{ one_liner }}</span>
    </div>
    <div class="view-toggles">
        <button class="view-toggle active" data-view="document"
                hx-get="/web/specs/{{ spec_id }}/document"
                hx-target="#canvas" hx-swap="innerHTML">&#128196;</button>
        <button class="view-toggle" data-view="board"
                hx-get="/web/specs/{{ spec_id }}/board"
                hx-target="#canvas" hx-swap="innerHTML">&#128451;</button>
        <button class="view-toggle" data-view="diagram"
                hx-get="/web/specs/{{ spec_id }}/diagram"
                hx-target="#canvas" hx-swap="innerHTML">&#9672;</button>
    </div>
    <div class="command-bar-right">
        <div id="agent-leds" hx-get="/web/specs/{{ spec_id }}/agents/leds"
             hx-trigger="load" hx-swap="innerHTML"></div>
        <div id="agent-controls" hx-get="/web/specs/{{ spec_id }}/agents/status"
             hx-trigger="load" hx-swap="innerHTML"></div>
        <a href="/web/specs/{{ spec_id }}/artifacts" hx-get="/web/specs/{{ spec_id }}/artifacts"
           hx-target="#canvas" hx-swap="innerHTML" class="btn btn-sm" title="Artifacts">&#8615;</a>
    </div>
</header>

<main class="canvas" id="canvas"
      hx-get="/web/specs/{{ spec_id }}/document"
      hx-trigger="load" hx-swap="innerHTML">
</main>

<footer class="mission-strip" id="mission-strip"
        hx-ext="sse" sse-connect="/api/specs/{{ spec_id }}/events/stream">
    <div id="mission-ticker"
         hx-trigger="sse:transcript_appended, sse:question_asked, sse:question_answered, sse:agent_step_started, sse:agent_step_finished"
         hx-get="/web/specs/{{ spec_id }}/ticker"
         hx-target="#mission-ticker" hx-swap="innerHTML">
    </div>
    <form class="mission-input" hx-post="/web/specs/{{ spec_id }}/chat"
          hx-target="#mission-ticker" hx-swap="innerHTML"
          hx-on::after-request="this.reset()">
        <span class="prompt-prefix">&gt;</span>
        <input type="text" name="message" placeholder="Direct the agents..." autocomplete="off" required>
        <button type="submit" class="btn btn-send">&#9166;</button>
    </form>
</footer>

<script>
    // View toggle active state management
    document.querySelectorAll('.view-toggles .view-toggle').forEach(function(btn) {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.view-toggles .view-toggle').forEach(function(b) {
                b.classList.remove('active');
            });
            btn.classList.add('active');
        });
    });
</script>
